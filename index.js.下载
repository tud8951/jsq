var versions;
$(function() {
	checkBrowser();
	showMore();

	window.onresize = function() {
		checkBrowser()
	}
})

function checkBrowser() {
	versions = common.versions();
	//console.log(versions)
	if (versions.mobile) {
		$('.more').show()
		if (versions.ios) {
			changeDomSort('iOS')
		} else if (versions.android) {
			changeDomSort('Android')
		}
	} else {
		if (!versions.mobile && versions.ios) {
			changeDomSort('MAC')
		} else if (!versions.mobile && !versions.ios) {
			changeDomSort('win')
		}
	}
}

function changeDomSort(type) {
	var parentDiv = $(`.down-btn[type=${type}]`).parents('.down-box')
	var prev = parentDiv.prev();
	var prevType = prev.attr('type');
	switch (type){
		case 'iOS':
			if (versions.android) {
				if (prevType === 'Android' && prev.html() != undefined) return
			}
			if (prev.html() != undefined) {
				prev.fadeOut("fast", function() {
					$(this).before(parentDiv);
					changeDomSort(type)
				});
				if (prevType === 'iOS' || prevType === 'Android') {
					prev.fadeIn();
				}
			} else {
				changeDomSort('Android')
			}
			break;
		case 'Android':
			if (versions.ios) {
				if (prevType === 'iOS' && prev.html() != undefined) return
			}
			if (prev.html() != undefined) {
				prev.fadeOut("fast", function() {
					$(this).before(parentDiv);
					changeDomSort(type)
				});
				if (prevType === 'iOS' || prevType === 'Android') {
					prev.fadeIn();
				}
			} else {
				changeDomSort('iOS')
			}
			break;
		case 'win':
			if (!versions.mobile && versions.ios) {
				if (prevType === 'MAC' && prev.html() != undefined) return
			}
			if (prev.html() != undefined) {
				prev.fadeOut("fast", function() {
					$(this).before(parentDiv);
					changeDomSort(type)
				}).fadeIn();
			} else {
				changeDomSort('MAC')
			}
			break
		case 'MAC':
			if (!versions.mobile && !versions.ios) {
				if (prevType === 'win' && prev.html() != undefined) return
			}
			if (prev.html() != undefined) {
				prev.fadeOut("fast", function() {
					$(this).before(parentDiv);
					changeDomSort(type)
				}).fadeIn();
			} else {
				changeDomSort('win')
			}
			break
	}
	$('.down-box').hide()
	if (versions.mobile) {
		$('.down-box[type=Android]').show()
		$('.down-box[type=iOS]').show()
	} else {
		$('.more').hide()
		$('.down-box').show()
	}
}

/**
 * 现实更多
 */
function showMore() {
	$('.more').on('click', function() {
		var str = ($('.more-title').text()).trim()
		if (str === '更多') {
			$('.down-box').show()
			$('.more-title').text('收起')
			$('.more i').addClass('rotate')
		} else if (str === '收起') {
			$('.down-box').hide()
			$('.down-box[type=Android]').show()
			$('.down-box[type=iOS]').show()
			$('.more-title').text('更多')
			$('.more i').removeClass('rotate')
		}
	})
}
